dist: trusty
sudo: false
language: r
cache: packages

env:
  global:
    - _R_CHECK_TESTS_NLINES_=999
    - _R_CHECK_LENGTH_1_CONDITION_=true

r_github_packages:
  - mlr-org/phng
  - mllg/backports

r:
  - 3.2
  - 3.3
  - 3.4
  - devel
dist: trusty
sudo: false
language: r
cache: packages

env:
  global:
    - _R_CHECK_TESTS_NLINES_=999
    - _R_CHECK_LENGTH_1_CONDITION_=true
    - secure: "d0xff7hriQyReF4y3/iR5sHJlXocKNKcN6/Gi/r9Hxsfuh2Hx3fouQCMSPP+Oba6MDgEvAfryToAxcmaoZByQMwgevB0OBy5xkatj3oTHmhN5Nbk3jNXxXfA6P0Oqxaf7lXVZk2+Ly+PWnbgXn0uhjzdaZo0cWtVJ660ajS0x9Q="

addons:
  apt:
    packages:
      - ghostscript

r:
  - oldrel
  - release
  - devel

before_install: R -q -e 'install.packages("devtools"); devtools::install_github("pat-s/tic@rcmdcheck-build-args"); tic::prepare_all_stages()'
install: R -q -e 'tic::install()'
before_script: R -q -e 'tic::before_script()'
script: R -q -e 'tic::script()'
after_success:
  - git checkout master
  - "export TRAVIS_COMMIT_MSG=\"$(git log --format=%B --no-merges -n 1)\""
  - R --no-save <<< "devtools::document(roclets=c('rd', 'collate', 'namespace'))"
  - ./thirdparty/gen_families.sh > man/mlrFamilies.Rd
  - git config user.name $GN
  - git config user.email $GM
  - git config credential.helper "store --file=.git/credentials"
  - bash inst/convert_to_ascii_news.sh
  - echo "https://$GT:@github.com" >> .git/credentials
  - git config push.default matching
  - git add --force NEWS
  - git add --force man/*
  - git add --force NAMESPACE
  - git commit man DESCRIPTION NAMESPACE NEWS -m "update auto-generated documentation [ci skip]" || true
  - git push
  - "[ $TRAVIS_PULL_REQUEST == \"false\" -a $TRAVIS_BRANCH == \"master\" ] && curl -s -X POST -H \"Content-Type:application/json\" -H \"Accept:application/json\" -H \"Travis-API-Version:3\" -H \"Authorization:token $TT\" -d \"{\\\"request\\\":{\\\"branch\\\":\\\"gh-pages\\\", \\\"message\\\":\\\"commit $TRAVIS_COMMIT $TRAVIS_COMMIT_MSG\\\"}}\" https://api.travis-ci.org/repo/mlr-org%2Fmlr-tutorial/requests"
  - R -q -e 'tic::after_success()'
